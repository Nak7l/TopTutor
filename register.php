<?php
include 'db_connect.php'; 

// if(!isset($_SESSION['tutor'])){
//     header("location: login.php");
// }
?>


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="admin/Imgs/Icon2.png" />
    <title>Register</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background: #e8f5e9;
            padding: 20px;
        }
        .container {
            width: 100%;
            max-width: 600px;
            box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);
            border-radius: 10px;
            padding: 20px;
            background: white;
            overflow-y: auto;
            max-height: 90vh;
        }
        .btn-primary {
            background-color: #0C0B60;
            border-color: #0C0B60;
        }
        .btn-primary:hover {
            background-color: #222187;
            border-color: #222187;
        }
        .back-btn {
            position: absolute;
            top: 10px;
            left: 10px;
            background: #0C0B60;
            color: white;
            border: none;
            padding: 5px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        .back-btn:hover {
            background: #222187;
        }
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
        }
        .error {
            color: red;
            font-size: 14px;
        }
    </style>
    <script>
        function toggleForm() {
            var role = document.getElementById('role').value;
            document.getElementById('tutorFields').style.display = role === 'tutor' ? 'block' : 'none';
            document.getElementById('studentFields').style.display = role === 'student' ? 'block' : 'none';
        }
    </script>
</head>
<body>
    <!-- Back Button -->
    <a href="index.php"><button class="back-btn">‚Üê Back</button></a>
    
    <div class="container">
        <h3 class="text-center">Register</h3>
            <div class="mb-3">
                <label for="role" class="form-label">Register as</label>
                <select class="form-control" name="role" id="role" onchange="toggleForm()" required>
                    <option value="">Select Tutor or Student</option>
                    <option value="tutor">Tutor</option>
                    <option value="student">Student</option>
                </select>
            </div>
            
            <!-- Tutor Form -->
            <div id="tutorFields" style="display: none;">
                <form action="register.php" method="POST" enctype="multipart/form-data">
                    <div class="row">
                        <div class="col-md-6 mb-3"><label>Name</label><input type="text" class="form-control" name="name" required></div>
                        <div class="col-md-6 mb-3">
                            <label>Gender</label>
                            <div>
                                <input type="radio" name="gender" value="Male"> Male
                                <input type="radio" name="gender" value="Female"> Female
                                <input type="radio" name="gender" value="Other"> Other
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3"><label>Email</label>
                            <input type="email" class="form-control" name="email" required>
                            <span id="email_error" class="error"></span>
                        </div>
                        <div class="col-md-6 mb-3"><label>Phone</label>
                            <input type="text" class="form-control" name="phone" required>
                            <span id="phone_error" class="error"></span>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3"><label>Password</label><input type="password" class="form-control" name="password" required></div>
                        <div class="col-md-6 mb-3"><label>Confirm Password</label><input type="password" class="form-control" name="confirm_password" required></div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3"><label>Institute Name (Optional)</label><input type="text" class="form-control" name="institute"></div>
                        <div class="col-md-6 mb-3"><label>City</label><input type="text" class="form-control" name="city"></div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3"><label>Subjects</label>
                            <select class="form-control" name="subject">
                                <option>Computer Science</option>
                                <option>Mathematics</option>
                                <option>Physics</option>
                                <option>Biology</option>
                                <option>Chemistry</option>
                                <option>Web Development</option>
                                <option>Data Science</option>
                            </select>
                        </div>  
                        <div class="col-md-6 mb-3"><label>Class</label>
                            <select class="form-control" name="class">
                                <option>1st Standard</option>
                                <option>2nd Standard</option>
                                <option>3rd Standard</option>
                                <option>4th Standard</option>
                                <option>5th Standard</option>
                                <option>6th Standard</option>
                                <option>7th Standard</option>
                                <option>8th Standard</option>
                                <option>9th Standard</option>
                                <option>10th Standard</option>
                                <option>11th Standard</option>
                                <option>12th Standard</option>
                                <option>BCA</option>
                                <option>B-Tech</option>
                                <option>B.Com</option>
                                <option>BBA</option>
                                <option>BA</option>
                                <option>MCA</option>
                                <option>M-Tech</option>
                                <option>M.Com</option>
                                <option>MBA</option>
                                <option>MA</option>
                            </select>
                        </div>              
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3"><label>Medium</label>
                            <select class="form-control" name="medium">
                                <option>English</option>
                                <option>Gujarati</option>
                                <option>Hindi</option>
                                <option>Marathi</option>
                                <option>Tamin</option>
                                <option>Telugu</option>
                                <option>Bangali</option>
                                <option>Punjabi</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3"><label>Salary</label>
                            <select class="form-control" name="salary">
                                <option>2000-5000</option>
                                <option>5000-10000</option>
                                <option>10000-15000</option>
                                <option>15000-25000</option>
                            </select>
                        </div>
                    </div>
                    <div class="mb-3"><label>Profile Picture</label><input type="file" class="form-control" name="profile" required></div>
                    <button type="submit" name="tutorRegister" class="btn btn-primary w-100">Register</button>
                </form>
            </div>
            
            <!-- Student Form -->
            <div id="studentFields" style="display: none;">
                <form action="register.php" method="POST" enctype="multipart/form-data">
                    <div class="row">
                        <div class="col-md-6 mb-3"><label>Name</label><input type="text" class="form-control" name="name" required></div>
                        <div class="col-md-6 mb-3">
                            <label>Gender</label>
                            <div>
                                <input type="radio" name="gender" value="Male" required> Male
                                <input type="radio" name="gender" value="Female"> Female
                                <input type="radio" name="gender" value="Other"> Other
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3"><label>Email</label><input type="email" class="form-control" name="email" required></div>
                        <div class="col-md-6 mb-3"><label>Phone</label><input type="text" class="form-control" name="phone" required></div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3"><label>City</label><input type="text" class="form-control" name="city"></div>
                        <div class="col-md-6 mb-3"><label>Class</label>
                            <select class="form-control" name="class">
                                <option>1st Standard</option>
                                <option>2nd Standard</option>
                                <option>3rd Standard</option>
                                <option>4th Standard</option>
                                <option>5th Standard</option>
                                <option>6th Standard</option>
                                <option>7th Standard</option>
                                <option>8th Standard</option>
                                <option>9th Standard</option>
                                <option>10th Standard</option>
                                <option>11th Standard</option>
                                <option>12th Standard</option>
                                <option>BCA</option>
                                <option>B-Tech</option>
                                <option>B.Com</option>
                                <option>BBA</option>
                                <option>BA</option>
                                <option>MCA</option>
                                <option>M-Tech</option>
                                <option>M.Com</option>
                                <option>MBA</option>
                                <option>MA</option>
                            </select>
                        </div> 
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3"><label>Password</label><input type="password" class="form-control" name="password" required></div>
                        <div class="col-md-6 mb-3"><label>Confirm Password</label><input type="password" class="form-control" name="confirm_password" required></div>
                    </div>
                    <div class="mb-3"><label>Profile Picture</label><input type="file" class="form-control" name="profile" required></div>
                    <button type="submit" name="studentRegister" class="btn btn-primary w-100">Register</button>
                </div>
            </form>
        <p class="mt-3 text-center">Already have an account? <a href="login.php">Login</a></p>
        
        <!-- Insert For Tutor Registration -->
        <?php
            if(isset($_POST['tutorRegister']))
            {
                $name = $_POST['name'];
                $gender = $_POST['gender'];
                $email = $_POST['email'];
                $phone = $_POST['phone'];
                $password = $_POST['password'];
                $confirm_password = $_POST['confirm_password'];
                $institute = $_POST['institute'];
                $subject = $_POST['subject'];
                $class = $_POST['class'];
                $medium = $_POST['medium'];
                $salary = $_POST['salary'];
                $city = $_POST['city'];

                $folder = 'admin/uploads/users_img/tutors/';
                $image_file = $_FILES['profile']['name'];
                $file = $_FILES['profile']['tmp_name'];
                $path = $folder.$image_file;
                $target_file = $folder.basename($image_file);
                $imageFileType = pathinfo($target_file, PATHINFO_EXTENSION);

                if (!filter_var($email, FILTER_VALIDATE_EMAIL)) 
                {
                    $error[] = '<p class="text-danger text-center">Invalid email format!</p>';
                }

                if (!preg_match('/^[0-9]{10}$/', $phone)) 
                {
                    $error[] = '<p class="text-danger text-center">Phone number must be exactly 10 digits!</p>';
                }

                $phone_check = mysqli_query($db, "SELECT * FROM tutors WHERE phone = '$phone'");
                if (mysqli_num_rows($phone_check) > 0) {
                    $error[] = '<p class="text-danger text-center">Phone number is already registered!</p>';
                }

                $email_check = mysqli_query($db, "SELECT * FROM tutors WHERE email = '$email'");
                if (mysqli_num_rows($email_check) > 0) {
                    $error[] = '<p class="text-danger text-center">Email is already registered!</p>';
                }

                if ($password !== $confirm_password) 
                {
                    $error[] = '<p class="text-danger text-center">Passwords do not match!</p>';
                }

                if($imageFileType != "jpg" && $imageFileType != "png" && $imageFileType != "jpeg")
                {
                    $error[] = '<p class="text-danger text-center">sorry, only JPG, PNG & JPEG files are allowed!</p>';
                }

                // if($_FILES['profile']['size']>1048576)
                if($_FILES['profile']['size']>9999999999)
                {
                    $error[] = '<p class="text-danger text-center">sorry, your image is too large. Upload less than 1 MB!</p>';
                }

                if(!isset($error1))
                {
                    move_uploaded_file($file, $target_file);
                    $password = password_hash($_POST['password'], PASSWORD_DEFAULT);
                    $result = mysqli_query($db, "INSERT INTO tutors (name, email, phone, gender, subject, class, medium, salary, city, password, institute, profile) VALUES ('$name', '$email', '$phone', '$gender', '$subject', '$class', '$medium', '$salary','$city', '$password', '$institute','$image_file')");

                    if($result)
                    {
                        $image_success = 1;
                        echo '<p class="text-success text-center">Registration Successfull! </br> Please Login Now!</p>';
                    }
                    else
                    {
                        echo '<p class="text-warning text-center">Somthing weting wrong</p>';
                    }
                } 
            }

            if(isset($error1))
            {
                foreach($error1 as $error1)
                {
                    echo '<div class = "message" id="message">'.$error1.'</div><br>';
                }
            }
        ?>
        <!-- Insert For Student Registration -->
        <?php
            if(isset($_POST['studentRegister']))
            {
                $name = $_POST['name'];
                $gender = $_POST['gender'];
                $email = $_POST['email'];
                $phone = $_POST['phone'];
                $password = $_POST['password'];
                $confirm_password = $_POST['confirm_password'];
                $class = $_POST['class'];
                $city = $_POST['city'];

                $folder = 'admin/uploads/users_img/tutors/';
                $image_file = $_FILES['profile']['name'];
                $file = $_FILES['profile']['tmp_name'];
                $path = $folder.$image_file;
                $target_file = $folder.basename($image_file);
                $imageFileType = pathinfo($target_file, PATHINFO_EXTENSION);

                if (!filter_var($email, FILTER_VALIDATE_EMAIL)) 
                {
                    $error[] = '<p class="text-danger text-center">Invalid email format!</p>';
                }

                if (!preg_match('/^[0-9]{10}$/', $phone)) 
                {
                    $error[] = '<p class="text-danger text-center">Phone number must be exactly 10 digits!</p>';
                }

                $phone_check = mysqli_query($db, "SELECT * FROM students WHERE phone = '$phone'");
                if (mysqli_num_rows($phone_check) > 0) {
                    $error[] = '<p class="text-danger text-center">Phone number is already registered!</p>';
                }

                $email_check = mysqli_query($db, "SELECT * FROM students WHERE email = '$email'");
                if (mysqli_num_rows($email_check) > 0) {
                    $error[] = '<p class="text-danger text-center">Email is already registered!</p>';
                }

                if ($password !== $confirm_password) 
                {
                    $error[] = '<p class="text-danger text-center">Passwords do not match!</p>';
                }

                if($imageFileType != "jpg" && $imageFileType != "png" && $imageFileType != "jpeg")
                {
                    $error[] = '<p class="text-danger text-center">sorry, only JPG, PNG & JPEG files are allowed!</p>';
                }

                // if($_FILES['profile']['size']>1048576)
                if($_FILES['profile']['size']>9999999999)
                {
                    $error[] = '<p class="text-danger text-center">sorry, your image is too large. Upload less than 1 MB!</p>';
                }

                if(!isset($error))
                {
                    move_uploaded_file($file, $target_file);
                    $password = password_hash($_POST['password'], PASSWORD_DEFAULT);
                    $result = mysqli_query($db, "INSERT INTO students (name, email, phone, gender, class, city, password, profile) VALUES ('$name', '$email', '$phone', '$gender', '$class', '$city', '$password', '$image_file')");

                    if($result)
                    {
                        $image_success = 1;
                        echo '<p class="text-success text-center">Registration Successfull! </br> Please Login Now!</p>';
                    }
                    else
                    {
                        echo '<p class="text-warning text-center">Somthing weting wrong</p>';
                    }
                } 
            }

            if(isset($error))
            {
                foreach($error as $error)
                {
                    echo '<div class = "message" id="message">'.$error.'</div><br>';
                }
            }

        ?>
    </div>

    <!-- Validation for Tutor registration form -->
    <script>
        function validateForm() {
            let email = document.getElementById("email").value;
            let phone = document.getElementById("phone").value;
            let password = document.getElementById("password").value;
            let confirm_password = document.getElementById("confirm_password").value;
            
            let emailPattern = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
            let phonePattern = /^[0-9]{10}$/;
            
            let valid = true;

            if (!emailPattern.test(email)) {
                document.getElementById("email_error").innerText = "Invalid email format!";
                valid = false;
            } else {
                document.getElementById("email_error").innerText = "";
            }

            if (!phonePattern.test(phone)) {
                document.getElementById("phone_error").innerText = "Phone number must be 10 digits!";
                valid = false;
            } else {
                document.getElementById("phone_error").innerText = "";
            }

            if (password !== confirm_password) {
                document.getElementById("password_error").innerText = "Passwords do not match!";
                valid = false;
            } else {
                document.getElementById("password_error").innerText = "";
            }

            return valid;
        }
        </script>

    <!-- Message Display -->
    <div id="message" style="display:none; padding: 10px; text-align: center; margin-top: 10px;"></div>

    <script>
        setTimeout(function() {
            document.getElementById('message').style.display = 'none';
        }, 5000); // Hide message after 5 seconds
    </script>



    <?php
        // $message = "lo";  // Initialize message variable

        // if(isset($_POST['studentRegister'])) {
        //     $db = mysqli_connect('localhost', 'root', '', 'TopTutor');

        //     $name = $_POST['name'];
        //     $gender = $_POST['gender'];
        //     $email = $_POST['email'];
        //     $phone = $_POST['phone'];
        //     $password = $_POST['password'];
        //     $confirm_password = $_POST['confirm_password'];
        //     $class = $_POST['class'];
        //     $city = $_POST['city'];

        //     $folder = 'admin/uploads/users_img/tutors/';
        //     $image_file = $_FILES['profile']['name'];
        //     $file = $_FILES['profile']['tmp_name'];
        //     $path = $folder.$image_file;
        //     $target_file = $folder.basename($image_file);
        //     $imageFileType = pathinfo($target_file, PATHINFO_EXTENSION);

        //     // Validation
        //     if ($password !== $confirm_password) {
        //         $message = '<span style="color: red;">Passwords do not match!</span>';
        //     } elseif($imageFileType != "jpg" && $imageFileType != "png" && $imageFileType != "jpeg") {
        //         $message = '<span style="color: red;">Only JPG, PNG & JPEG files are allowed!</span>';
        //     } elseif ($_FILES['profile']['size'] > 9999999) {
        //         $message = '<span style="color: red;">Image too large! Upload less than 1 MB.</span>';
        //     } else {
        //         move_uploaded_file($file, $target_file);
        //         $password = password_hash($_POST['password'], PASSWORD_DEFAULT);
        //         $result = mysqli_query($db, "INSERT INTO students (name, email, phone, gender, class, city, password, profile) VALUES ('$name', '$email', '$phone', '$gender', '$class', '$city', '$password', '$image_file')");

        //         if($result) {
        //             $message = '<span style="color: green;">Registration Successful!</span>';
        //         } else {
        //             $message = '<span style="color: red;">Something went wrong, try again.</span>';
        //         }
        //     }
        // }
    ?>
    <!-- Display Message -->
    <!-- <script>
        document.getElementById("messageBox").innerHTML = "<?php echo $message; ?>";
        document.getElementById("messageBox").style.display = "block";
    </script>
    


</body>
</html>
